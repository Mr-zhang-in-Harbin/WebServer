# WebServer

本项目主要通过参考游双的《Linux高性能服务器编程》一书和[TinyWebserver](https://github.com/qinguoyi/TinyWebServer "https://github.com/qinguoyi/TinyWebServer")来实现。

## 线程池

线程池是通过提前申请线程，并在程序运行过程中动态的将任务绑定在线程上，以实现程序的多线程运行，且由于线程是提前申请的，故大大减少了程序在运行中申请线程的消耗。线程池主要由线程队列和候选任务队列构成。当有新的任务被提交时，加锁后加入任务队列。每个线程在创建时会绑定一个run函数，通过while循环在线程的生命周期内持续运行，while循环内的逻辑是不断尝试访问任务队列并提取任务执行，若无任务执行，则利用信号量等待新的任务入队。

## epoll

epoll和select、poll一样，是linux内核提供的I/O复用机制。epoll通过文件描述符，使用一组函数来完成任务。使用epoll_create创建并返回文件描述符、epoll_ctl函数修改和删除文件描述符上的注册事件、epoll_wait等待文件描述符上的事件。epoll的操作主要分为LT、ET两种模式，其中LT在每次调用时都会向程序报告事件，直到事件被处理，而ET则只触发一次，期待程序一次完成所有处理。

从实现原理上来说，select和poll都采用轮询方式，而epoll则采用回调方式，因此算法复杂度更低。但是，当活动的连接较多时，因回调函数被触发的很频繁，因此效率未必比另两者更高。因此，epoll更适用于连接数量多，但活动较少的情况。

（详细内容请参考Linux高性能服务器编程 游双 第九章 I/O复用）

## 数据库

通过与mysql数据库连接，实现用户的注册与登录。

## 日志系统

日志系统主要支持异步、同步两种操作模式，在同步模式下，每次产生待处理日志后，由主线程进行写入，实现比较简单，但是由于主线程在此时负责处理日志，会导致对连接处理的时延增大。在异步模式下，本项目通过实现一个阻塞队列，来进行消费者、生产者场景的模拟。主线程在产生待处理日志之后，会将信息放入阻塞队列，项目会在启动时额外创建一个消费者进程，用于从阻塞队列中提取待处理的日志消息，并将该消息写入日志文件中。该模式下主线程可以更加集中于它自己的业务，从而提高项目的并发性能。
